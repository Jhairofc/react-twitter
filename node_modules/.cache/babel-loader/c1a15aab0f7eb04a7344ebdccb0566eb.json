{"ast":null,"code":"import { LOCALHOST, TOKEN } from \"../utils/Constants\";\nimport jwtDecode from \"jwt-decode\";\nexport function LoginApi(login) {\n  const uri = `${LOCALHOST}/login`;\n  const loginAPI = { ...login,\n    email: login.email.toLowerCase()\n  }; //parametros antes de consumir la API\n\n  const params = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(loginAPI)\n  };\n  return fetch(uri, params).then(response => {\n    if (response.status > 200 && response.status < 300) return response.json();\n    return {\n      code: response.status,\n      message: \"Error al iniciar sesión, usuario i/o contrasena inválidos\"\n    };\n  }).then(result => result).catch(error => {\n    return {\n      code: 500,\n      message: \"Ha ocurrido un error, intente más tarde\"\n    };\n  });\n}\nexport function setToken(token) {\n  console.log(token);\n  console.log(TOKEN);\n  localStorage.setItem(\"token\", \"1234\"); //localStorage.setItem(TOKEN, token);\n}\nexport function getToken() {\n  return localStorage.getItem(TOKEN);\n}\nexport function logOut() {\n  localStorage.removeItem(TOKEN);\n}\nexport function isLogged() {\n  //Verificamos si hay token\n  const token = getToken();\n\n  if (!token) {\n    logOut();\n    return null;\n  } //Verificamos si el token ha expirado\n\n\n  if (isTokenExpired(token)) {\n    logOut();\n    return null;\n  } //Si el token sigue activo se retorna el token decodificado\n\n\n  return jwtDecode(token);\n}\nexport function isTokenExpired(token) {\n  const {\n    exp\n  } = jwtDecode(token);\n  const timeToken = exp * 1000; //Se pasa la fecha del token a miliseconds\n\n  const timeout = timeToken - Date.now();\n  if (timeout < 0) return true; //Token caducado */\n\n  return true;\n}","map":{"version":3,"sources":["/Users/jhairorivera/Documents/Cursos/twitter/src/api/Login.js"],"names":["LOCALHOST","TOKEN","jwtDecode","LoginApi","login","uri","loginAPI","email","toLowerCase","params","method","headers","body","JSON","stringify","fetch","then","response","status","json","code","message","result","catch","error","setToken","token","console","log","localStorage","setItem","getToken","getItem","logOut","removeItem","isLogged","isTokenExpired","exp","timeToken","timeout","Date","now"],"mappings":"AAAA,SAAQA,SAAR,EAAmBC,KAAnB,QAA+B,oBAA/B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAO,SAASC,QAAT,CAAkBC,KAAlB,EAAwB;AAC3B,QAAMC,GAAG,GAAI,GAAEL,SAAU,QAAzB;AACA,QAAMM,QAAQ,GAAG,EACb,GAAGF,KADU;AAEbG,IAAAA,KAAK,EAAEH,KAAK,CAACG,KAAN,CAAYC,WAAZ;AAFM,GAAjB,CAF2B,CAM3B;;AACA,QAAMC,MAAM,GAAG;AACXC,IAAAA,MAAM,EAAE,MADG;AAEXC,IAAAA,OAAO,EAAE;AACL,sBAAgB;AADX,KAFE;AAKXC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeR,QAAf;AALK,GAAf;AAOA,SAAOS,KAAK,CAACV,GAAD,EAAMI,MAAN,CAAL,CAAmBO,IAAnB,CAAwBC,QAAQ,IAAE;AACrC,QAAGA,QAAQ,CAACC,MAAT,GAAiB,GAAjB,IAAwBD,QAAQ,CAACC,MAAT,GAAkB,GAA7C,EACI,OAAOD,QAAQ,CAACE,IAAT,EAAP;AAEJ,WAAO;AAACC,MAAAA,IAAI,EAAEH,QAAQ,CAACC,MAAhB;AAAwBG,MAAAA,OAAO,EAAE;AAAjC,KAAP;AACH,GALM,EAMNL,IANM,CAMDM,MAAM,IAAIA,MANT,EAONC,KAPM,CAOAC,KAAK,IAAG;AACX,WAAO;AAACJ,MAAAA,IAAI,EAAE,GAAP;AAAYC,MAAAA,OAAO,EAAE;AAArB,KAAP;AACH,GATM,CAAP;AAUH;AACD,OAAO,SAASI,QAAT,CAAkBC,KAAlB,EAAwB;AAC3BC,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY3B,KAAZ;AACA4B,EAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8B,MAA9B,EAH2B,CAI3B;AAEH;AACD,OAAO,SAASC,QAAT,GAAmB;AACtB,SAAOF,YAAY,CAACG,OAAb,CAAqB/B,KAArB,CAAP;AACH;AACD,OAAO,SAASgC,MAAT,GAAiB;AACpBJ,EAAAA,YAAY,CAACK,UAAb,CAAwBjC,KAAxB;AACH;AACD,OAAO,SAASkC,QAAT,GAAmB;AACtB;AACA,QAAMT,KAAK,GAAGK,QAAQ,EAAtB;;AACA,MAAG,CAACL,KAAJ,EAAU;AACNO,IAAAA,MAAM;AACN,WAAO,IAAP;AACH,GANqB,CAOtB;;;AACA,MAAGG,cAAc,CAACV,KAAD,CAAjB,EAAyB;AACrBO,IAAAA,MAAM;AACN,WAAO,IAAP;AACH,GAXqB,CAYtB;;;AACA,SAAO/B,SAAS,CAACwB,KAAD,CAAhB;AACH;AACD,OAAO,SAASU,cAAT,CAAwBV,KAAxB,EAA8B;AACjC,QAAM;AAACW,IAAAA;AAAD,MAAQnC,SAAS,CAACwB,KAAD,CAAvB;AACA,QAAMY,SAAS,GAAGD,GAAG,GAAG,IAAxB,CAFiC,CAEH;;AAC9B,QAAME,OAAO,GAAGD,SAAS,GAAGE,IAAI,CAACC,GAAL,EAA5B;AACA,MAAGF,OAAO,GAAG,CAAb,EACI,OAAO,IAAP,CAL6B,CAKhB;;AACjB,SAAO,IAAP;AACH","sourcesContent":["import {LOCALHOST, TOKEN} from \"../utils/Constants\";\nimport jwtDecode from \"jwt-decode\";\nexport function LoginApi(login){\n    const uri = `${LOCALHOST}/login`;\n    const loginAPI = {\n        ...login,\n        email: login.email.toLowerCase()\n    }\n    //parametros antes de consumir la API\n    const params = {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(loginAPI)\n    }\n    return fetch(uri, params).then(response=>{\n        if(response.status >200 && response.status < 300)\n            return response.json();\n\n        return {code: response.status, message: \"Error al iniciar sesión, usuario i/o contrasena inválidos\"}\n    })\n    .then(result => result)\n    .catch(error =>{\n        return {code: 500, message: \"Ha ocurrido un error, intente más tarde\"}\n    }); \n}\nexport function setToken(token){\n    console.log(token);\n    console.log(TOKEN);\n    localStorage.setItem(\"token\", \"1234\");\n    //localStorage.setItem(TOKEN, token);\n\n}\nexport function getToken(){\n    return localStorage.getItem(TOKEN);\n}\nexport function logOut(){\n    localStorage.removeItem(TOKEN);\n}\nexport function isLogged(){\n    //Verificamos si hay token\n    const token = getToken();\n    if(!token){\n        logOut();\n        return null;\n    }\n    //Verificamos si el token ha expirado\n    if(isTokenExpired(token)){\n        logOut();\n        return null;\n    }\n    //Si el token sigue activo se retorna el token decodificado\n    return jwtDecode(token);\n}\nexport function isTokenExpired(token){\n    const {exp} = jwtDecode(token);\n    const timeToken = exp * 1000; //Se pasa la fecha del token a miliseconds\n    const timeout = timeToken - Date.now(); \n    if(timeout < 0)\n        return true; //Token caducado */\n    return true;\n}"]},"metadata":{},"sourceType":"module"}